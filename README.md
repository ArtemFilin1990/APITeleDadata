# APITeleDadata

Telegram-–±–æ—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–º–ø–∞–Ω–∏–π –ø–æ –ò–ù–ù/–û–ì–†–ù —á–µ—Ä–µ–∑ DaData.

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –ø—Ä–æ–µ–∫—Ç

- –ò—â–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é/–ò–ü –ø–æ –ò–ù–ù, –û–ì–†–ù, –û–ì–†–ù–ò–ü.
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ —Ä–µ–∂–∏–º–∞ –æ—Ç–≤–µ—Ç–∞:
  - **Direct** ‚Äî –ø—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –≤ DaData `findById/party`.
  - **MCP (AI)** ‚Äî —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç—á—ë—Ç —á–µ—Ä–µ–∑ OpenAI + MCP DaData.
- –î–ª—è —Ä–µ–∂–∏–º–∞ ¬´–ü–æ–¥—Ä–æ–±–Ω–µ–µ¬ª –≤—ã–≤–æ–¥–∏—Ç **–≤—Å–µ –ø–æ–ª—è –¥–µ—Ä–µ–≤–∞ `data.*`**, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª—å–Ω–æ –≤–µ—Ä–Ω—É–ª DaData –ø–æ –≤–∞—à–µ–º—É —Ç–∞—Ä–∏—Ñ—É (–≤–∫–ª—é—á–∞—è –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏ –º–∞—Å—Å–∏–≤—ã).

> –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö: API DaData (`https://dadata.ru/api/`), —Ä–∞–±–æ—á–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç endpoint `findById/party`.
> –†–∞–∑–¥–µ–ª –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ `#openapi` –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±–æ—Ç–∞.

## –ü–æ–∫—Ä—ã—Ç–∏–µ –ø–æ–ª–µ–π DaData

- –í direct-—Ä–µ–∂–∏–º–µ –±–æ—Ç –∑–∞–±–∏—Ä–∞–µ—Ç –æ—Ç–≤–µ—Ç `findById/party` –∏ –º–∞–ø–∏—Ç –≤—Å–µ –ø–æ–ª—è –∏–∑ `data.*` –±–µ–∑ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ whitelist.
- –í —Ä–µ–∂–∏–º–µ `üìÑ –ü–æ–¥—Ä–æ–±–Ω–µ–µ` –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø–æ–ª–Ω—ã–π flatten-–¥–∞–º–ø –ø–æ –≤—Å–µ–º —É–∑–ª–∞–º (–≤–∫–ª—é—á–∞—è –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏ –º–∞—Å—Å–∏–≤—ã).
- –ü—Ä–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º —Ç–∞—Ä–∏—Ñ–µ DaData —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–ª–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –ø–æ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–π –≤–µ—Ä–Ω—ë—Ç API.

## –¢–µ–∫—É—â–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ DaData (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ)

–°–µ–π—á–∞—Å –≤ –∫–æ–¥–µ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã —Ç–æ–ª—å–∫–æ:

- `findById/party` (direct-—Ä–µ–∂–∏–º, `dadata_direct.py`)
- `mcp.dadata.ru/mcp` (MCP-—Ä–µ–∂–∏–º, `dadata_mcp.py`)

API/–º–µ—Ç–æ–¥—ã DaData –∏–∑ —Ä–∞–∑–¥–µ–ª–æ–≤ `#other`, `#passport`, `#phone`, `clean/*`, `suggest/*`, `find-bank`, `find-party`, `find-affiliated`, `delivery`, –∞ —Ç–∞–∫–∂–µ OpenAPI YAML-—Å—Ö–µ–º—ã (`profile.yml`, `suggestions.yml`, `cleaner.yml`) –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –±–æ—Ç–∞ **–Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é**.

## –§—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞

- –ö–æ–º–∞–Ω–¥—ã `/start`, `/help`, `/find`.
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–¥–Ω–æ–≥–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ –æ–¥–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏.
- –ö–∞—Ä—Ç–æ—á–∫–∞ –∫–æ–º–ø–∞–Ω–∏–∏ + –¥–µ–π—Å—Ç–≤–∏—è:
  - `üìÑ –ü–æ–¥—Ä–æ–±–Ω–µ–µ`
  - `üì§ –≠–∫—Å–ø–æ—Ä—Ç`
  - `üß© –í CRM`
- –ü–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º (—Ñ–∏–Ω–∞–Ω—Å—ã, –∫–æ–Ω—Ç–∞–∫—Ç—ã, –Ω–∞–ª–æ–≥–∏, –¥–æ–∫—É–º–µ–Ω—Ç—ã, —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –∏ –¥—Ä.).
- In-memory TTL-–∫—ç—à –æ—Ç–≤–µ—Ç–æ–≤ DaData –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Python 3.10+
- aiogram 3.x (–æ—Å–Ω–æ–≤–Ω–æ–π —Ä–∞–Ω—Ç–∞–π–º)
- pyTelegramBotAPI (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ä–∞–Ω—Ç–∞–π–º)
- aiohttp, python-dotenv, openai

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```text
.
‚îú‚îÄ‚îÄ bot.py               # –ó–∞–ø—É—Å–∫ aiogram-–±–æ—Ç–∞
‚îú‚îÄ‚îÄ bot_telebot.py       # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∑–∞–ø—É—Å–∫ TeleBot
‚îú‚îÄ‚îÄ handlers.py          # –ö–æ–º–∞–Ω–¥—ã, FSM, –∫–∞—Ä—Ç–æ—á–∫–∏ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è
‚îú‚îÄ‚îÄ dadata_direct.py     # –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ DaData findById/party
‚îú‚îÄ‚îÄ dadata_mcp.py        # MCP/OpenAI —Ä–µ–∂–∏–º
‚îú‚îÄ‚îÄ validators.py        # –í–∞–ª–∏–¥–∞—Ü–∏—è –ò–ù–ù/–û–ì–†–ù
‚îú‚îÄ‚îÄ keyboards.py         # –ò–Ω–ª–∞–π–Ω/—Ä–µ–ø–ª–∞–π-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ config.py            # ENV-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ cache.py             # TTL-–∫—ç—à
‚îú‚îÄ‚îÄ http_client.py       # –û–±—â–∞—è aiohttp-—Å–µ—Å—Å–∏—è
‚îú‚îÄ‚îÄ tests/               # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ Makefile
‚îî‚îÄ‚îÄ Dockerfile
```

## –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

```bash
python3 -m venv .venv
. .venv/bin/activate
pip install -r requirements.txt
cp .env.example .env
python bot.py
```

## ENV

–ú–∏–Ω–∏–º—É–º –¥–ª—è direct-—Ä–µ–∂–∏–º–∞:

```env
TELEGRAM_BOT_TOKEN=...
DADATA_API_KEY=...
```

–î–ª—è MCP-—Ä–µ–∂–∏–º–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:

```env
DADATA_SECRET_KEY=...
OPENAI_API_KEY=...
```

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∞–ª–∏–∞—Å—ã:

- `BOT_TOKEN` ‚Üí `TELEGRAM_BOT_TOKEN`
- `DADATA_TOKEN` ‚Üí `DADATA_API_KEY`
- `DADATA_SECRET` ‚Üí `DADATA_SECRET_KEY`

–î–æ–ø. –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

- `LOG_LEVEL` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `INFO`)
- `BOT_STARTUP_MAX_RETRIES`
- `BOT_STARTUP_RETRY_BASE_DELAY_SECONDS`
- `BOT_STARTUP_RETRY_MAX_DELAY_SECONDS`

## Makefile

```bash
make install
make run-prod
make run-telebot
make test
```

## Docker

```bash
docker build -t api-tele-dadata .
docker run --rm --env-file .env api-tele-dadata
```

## –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ü—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–≤—ã—Ö —Å–±–æ—è—Ö Telegram API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è retry —Å backoff (–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ ENV).
- –ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏; `.env` –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ–ø–∞–¥–∞—Ç—å –≤ git.
- –ü–æ–ª–Ω–æ—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ª–∏–º–∏—Ç–æ–≤/—Ç–∞—Ä–∏—Ñ–∞ DaData –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–Ω–µ—à–Ω–∏—Ö API.

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
